## 进程与线程

线程：

UI线程是干什么用的：应用启动时，开启一个主线程，管理界面并进行事件分发。
Hander原理
Handler，loop轮询检测发送消息到MessagerQuery,MessageQuery对Message入列，Handler回调方法处理消息，重写handMessage方法刷新ui
**Handler传递消息：**
子线程传递message给主线程：
第一种：
handler.obtainMessage(3).sendToTarget();
单用可行，但是要传递message不行，比如：
Message message = new Message();
message.obj = result;
handler.obtainMessage(3,message).sendToTarget();
同样地，用bundle传递message也不行：
Message message = new Message();
Bundle bundle = new Bundle();
bundle.putString("aaa",result);
message.setData(bundle);
handler.obtainMessage(3,message).sendToTarget();
第二种：
Message message = handler.obtainMessage(3);
message.obj = result;
handler.sendMessage(message);
同样地，用bundle传值也可以：
Message message = handler.obtainMessage(3);
Bundle bundle = new Bundle();
bundle.putString("aaa",result);
message.setData(bundle);
handler.sendMesssage(message);
总结：
不传递数据：
handler.obtainMessage(3).sendToTarget();
传递数据：
Message message = handler.obtainMessage(3);
handler.sendMessage(message);
总之：
就是不能用
Message message = new Message();
handler.obtainMessage(3,message).sendToTarget();
进程间通信：
- 共享数据：Intent传递数据-使用Bundle；文件共享-SharedPreferences
- 基于Binder：Messager；AIDL-Android接口定义语言；ContentProvider-天生支持跨进程访问，共享数据（向其他组件或应用共享数据）
- 网络通信：Socket（套接字）Linux跨进程通信就是。
广播可以吗？
进程间通信Android提供了Binder机制，intent就是基于binder实现。广播也是进程间通信。
说说对Handler, Looper, 以及HandlerThread的理解；Handler原理
简述Handler消息机制：Handler发送和接收消息的实现，尤其是Message的消息载体的工作流程
Handler 在activity中造成内存泄漏的情形，为什么泄漏以及在内存中的引用关系

AIDL应用：（跨进程通信）
心神学堂：没有用到。
心神视讯：请求视频聊天。
ITelephony telephony = ITelephony.Stub.asInterface(binder);
明天继续，路上思考。
随后再研究，这个是音视频里的东西。
IM-ios项目：应该也有AIDL。用到的时候再看。
.SharedPreference跨进程使用会怎么样？如何保证跨进程使用安全？
在两个应用的manifest配置中好相同的shartdUserId属性，A应用正常保存数据，B应用
createPackageContext("com.netease.nim.demo", CONTEXT_IGNORE_SECURITY)
获取context然后获取应用数据，为保证数据安全，使用加密存储

线程间通信：
- Handler
- AsyncTask
- RxJava

说说对Handler, Looper, 以及HandlerThread的理解
为什么不能在子线程中更新UI操作：️
因为UI控件不是线程安全，并发访问会导致ANR。
加上锁非常复杂。
都知道在子线程中不能进行ui操作，但是为什么不能进行(主线程)ui线程的操作。️
https://www.jianshu.com/p/acf574f08efc
View和主线程的联系。
只能在主线程更新View。WindowManager继承ViewManager，里边有addView方法，ViewRootImpl里也有addView方法。setContentView是在主线程中进行的，ViewRootImpl指向主线程。子线程操作View报错。
https://www.cnblogs.com/dasusu/p/8047172.html
View.post也是通过Handler在UI线程中更新操作的。（明天再看）
跨进程通信的几种方式
Intent,比如拨打电话
ContentProvider 数据库存储数据
Broadcast 广播通信
AIDL通信，通过接口共享数据