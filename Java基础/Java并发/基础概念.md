## 基础概念

### 目录

- 1.操作系统与硬件
- 2.进程和线程(主线程/单线程/多线程)
- 3.并行和并发
- 4.同步和异步

### 1.操作系统与硬件

- CPU核心数与线程数：4核CPU同时运行4个线程。用intel超线程技术，4核CPU可以同时运行8个线程。
- CPU时间片轮转机制：高低峰。RR调度。new Thread。1个CPU，100个线程 x 5ms/线程 = 500ms。
- 取CPU的逻辑核心数：int count = Runtime.getRuntime().availableProcessors();

### 2.进程和线程

* 进程：操作系统资源分配的最小单位。一个app就是一个进程。比较独立，和CPU没有关系。
* 线程：CPU调度的最小单位，一种有限的系统资源。共享一个进程内的资源。Java不能用CPU指定线程，C可以。（操作系统研究到位，重点）
* 关系：进程大于线程，线程依附于进程存在，一个进程可以包含多个线程。线程会共享进程内的资源，共享变量使线程间通信比进程间通信更高效更容易。

**单线程和多线程**

- 单线程：一个线程，一个任务，同一时间只有一个线程。如js。
- 多线程：多个线程，多个任务，同一时间同时进行，是实现异步的一个手段。

**主线程**

* 是什么-为什么-怎么样：APP MainThred=UIThread，负责绘制UI界面。耗时操作执行5s，会造成ANR，所以有了Work Thread子线程。Linux最多开1000个线程，Window最多2000个。
* 注意：耗时操作在主线程执行会造成ANR，但是主线程可以执行休眠sleep操作即Thread.sleep(5000)；
* 深度思考：耗时操作不一定会引起ANR。当主线程接收到有需要处理的请求的时候，会造成ANR。例如主线程正在休眠，按返回键就会造成ANR。但是当主线程sleep没有接收到请求的时候就不会造成ANR。
* ANR：有人(事件或操作)发出了一个请求，应用没有响应，应用不会处理或不想处理你的请求。
* 链接：https://www.jianshu.com/p/dc282d0d5ed3

### 3.并行和并发：(重点)

* 并行：高速公路可以同时运行4辆车。4核CPU并行度为8个线程。
* 并发：单位时间内的并发量。

**高并发编程**

定义：多核多CPU，可以同时运行多个线程。

好处：

* 充分利用CPU，提高响应时间。迅雷：多线程下载快。
* 程序开发模块化，简单化，异步化。多个线程，下载图片放在work thread，简化ui thread里的代码。

注意：

* 安全性。线程共享进程内的资源。线程安全问题；死锁；操作系统开的线程数有限。
* 每个线程有一个栈空间，开一个栈消耗1M的内存，可能造成死机。线程要消耗资源，保存数据到内存或硬盘，其他线程一存一取耗费时间即上下文切换，一个上下文切换（操作系统术语）大概消耗2万个CPU的时间周期。所以要用线程池。（操作系统，计算机硬件）
* 总：声明线程，消耗内存。

### 4.同步和异步

- 同步：需要等待。一个线程结束另一个线程才开始。会造成阻塞，死锁等。例子：电话。synchronized同步锁，同步机制，同一时刻只能有一个线程进行。
- 异步：不需要等待，可同时进行。多个线程同时进行。多线程并发是实现异步的一个手段。例子：广播。

用途：

- web端都是异步；android端有同步有异步。
- 项目：异步居多，效率高。

后果：

同步可以避免出现死锁，读脏数据的发生，一般共享某一资源的时候用，如果每个人都有修改权限，同时修改一个文件，有可能使一个人读取另一个人已经删除的内容，就会出错，同步就会按顺序来修改。原则：别人用你不能用，别人用完了你再用。线程安全的其中一个作用：保证同一个对象。做到线程安全就会有时间上的代价，因为别人用的时候你不能用。

例子1：

场景：循环list集合的过程中，add和remove就不太好。原则：循环的时候不删除，循环结束后再删除。因为循环时候删除很可能出错，list已经发生了变化。

使用：contains。if（list.contains（userDto））{   add/remove    }  因为contains表示if循环已经结束了，再开始add/remove。

代码：
![image]{https://github.com/2211785113/Blog/blob/master/images/syn1.jpg}

### 进阶

书籍：《Java并发编程实战》

链接：https://blog.csdn.net/aimashi620/article/details/82017700

实践：主动有意识多用线程。

Android架构师：基础知识点一定要非常清晰。

阿里：Java；百度：C。




